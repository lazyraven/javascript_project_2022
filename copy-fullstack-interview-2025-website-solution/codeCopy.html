<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shareable Checklist</title>
  <style>
    body{
      background-color: #333;
    }
    table {
      width: 70%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    th,
    td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }

    .blue {
      color: blue;
    }

    .form-container {
      margin: 15px 0;
    }

    input[type="text"] {
      padding: 5px;
      width: 250px;
    }

    button {
      padding: 6px 12px;
      margin-left: 5px;
      cursor: pointer;
    }

    .delete-btn {
      background: #ff4d4d;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 5px 10px;
      cursor: pointer;
    }

    .share-btn {
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <h3 class="blue">Questions :</h3>
<h3>Run the application with this command (npx serve . )</h3>
  <!-- Add Question Form -->
  <div class="form-container" id="formContainer">
    <input type="text" id="newQuestion" placeholder="Enter new question">
    <button id="addBtn">Add</button>
    <button id="shareBtn" class="share-btn">Share</button>
  </div>

  <!-- Questions Table -->
  <table>
    <thead>
      <tr>
        <th>Done</th>
        <th>Question</th>
        <th id="actionHeader">Action</th>
      </tr>
    </thead>
    <tbody id="questionTable"></tbody>
  </table>


  <!-- Firebase SDK CDN-->
  <script type="module">
        // import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { 
      getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot 
    } from "https://www.gstatic.com/firebasejs/12.1.0//firebase-firestore.js";

    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  // import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";
  
    // import { initializeApp } from "firebase/app";
    // import { getAnalytics } from "firebase/analytics";
    // âœ… Replace with your Firebase config
 const firebaseConfig = {
    apiKey: "AIzaSyDM68ZvlbTiu2z3gstdzTaW6wDTl0C3SoE",
    authDomain: "fullstack-interview-checklist.firebaseapp.com",
    projectId: "fullstack-interview-checklist",
    storageBucket: "fullstack-interview-checklist.firebasestorage.app",
    messagingSenderId: "988231979757",
    appId: "1:988231979757:web:e0c8d5117efad245bdb2e4",
    measurementId: "G-HD0VPM6YRF"
  };


    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // const app = initializeApp(firebaseConfig);
    // const db= getAnalytics(app);
  
    const tableBody = document.getElementById("questionTable");
    const addBtn = document.getElementById("addBtn");
    const newQuestionInput = document.getElementById("newQuestion");
    const shareBtn = document.getElementById("shareBtn");
    const formContainer = document.getElementById("formContainer");
    const actionHeader = document.getElementById("actionHeader");

    // ðŸ”‘ Get userId (either from URL ?id=... or localStorage)
    const urlParams = new URLSearchParams(window.location.search);
    let userId = urlParams.get("id");

    let isOwner = false;
    if (!userId) {
      userId = localStorage.getItem("userId");
      if (!userId) {
        userId = "user_" + crypto.randomUUID();
        localStorage.setItem("userId", userId);
      }
      isOwner = true;
    }

    const questionsCol = collection(db, "questions", userId, "items");

    // Render table
    function renderTable(questions) {
      tableBody.innerHTML = "";
      questions.forEach(q => {
        const row = document.createElement("tr");

        // Checkbox
        const tdCheckbox = document.createElement("td");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = q.done;
        if (!isOwner) checkbox.disabled = true; // read-only mode for shared links
        checkbox.addEventListener("change", async () => {
          if (isOwner) {
            await updateDoc(doc(db, "questions", userId, "items", q.id), { done: checkbox.checked });
          }
        });
        tdCheckbox.appendChild(checkbox);

        // Question text
        const tdText = document.createElement("td");
        tdText.textContent = q.text;

        // Delete button
        const tdAction = document.createElement("td");
        if (isOwner) {
          const deleteBtn = document.createElement("button");
          deleteBtn.textContent = "Delete";
          deleteBtn.classList.add("delete-btn");
          deleteBtn.addEventListener("click", async () => {
            await deleteDoc(doc(db, "questions", userId, "items", q.id));
          });
          tdAction.appendChild(deleteBtn);
        }
        row.appendChild(tdCheckbox);
        row.appendChild(tdText);
        if (isOwner) row.appendChild(tdAction);

        tableBody.appendChild(row);
      });
    }

    // Add new question
    if (isOwner) {
      addBtn.addEventListener("click", async () => {
        const text = newQuestionInput.value.trim();
        if (text) {
          await addDoc(questionsCol, { text, done: false });
          newQuestionInput.value = "";
        }
      });
    } else {
      // Hide add form and action column if not owner
      formContainer.style.display = "none";
      actionHeader.style.display = "none";
    }

    // Share link
    if (isOwner) {
      shareBtn.addEventListener("click", () => {
        const shareUrl = `${window.location.origin}${window.location.pathname}?id=${userId}`;
        navigator.clipboard.writeText(shareUrl).then(() => {
          alert("Shareable link copied to clipboard:\n" + shareUrl);
        });
      });
    }

    // Listen for realtime updates
    onSnapshot(questionsCol, (snapshot) => {
      const questions = snapshot.docs.map(docSnap => ({
        id: docSnap.id,
        ...docSnap.data()
      }));
      renderTable(questions);
    });
  </script>

</body>

</html>